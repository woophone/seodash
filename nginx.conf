server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    # Block all search engines via header (belt-and-suspenders with robots.txt + meta tags)
    add_header X-Robots-Tag "noindex, nofollow, noarchive, nosnippet" always;

    # Client-facing pages — no auth required
    # Any /xx/ path (client code) is public
    location ~ ^/[a-z]{2,4}/ {
        try_files $uri $uri/ =404;
    }

    # robots.txt — always accessible
    location = /robots.txt {
        try_files $uri =404;
    }

    # favicon — always accessible
    location ~ ^/favicon\.(ico|svg)$ {
        try_files $uri =404;
    }

    # Static assets — no auth
    location /_astro/ {
        try_files $uri =404;
    }

    # Everything else (root dashboard) — password protected
    location / {
        auth_basic "SEO Dashboard";
        auth_basic_user_file /etc/nginx/.htpasswd;
        try_files $uri $uri/ =404;
    }
}
